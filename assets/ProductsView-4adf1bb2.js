import{a4 as Q,r,ao as M,a7 as j,a8 as E,a9 as W,j as l,aa as s,b8 as X,a2 as Y,a_ as Z,b0 as C,b9 as ee,au as ae,ab as le,ac as te,V as w,ae as x,ai as o,a$ as oe,ay as se,az as re,an as ne,aU as ue,ba as ie,aA as de,ad as me,am as ce,L as pe}from"./index-8d03ecdb.js";import{c as ve,d as h,a as ge,f as Ve,u as fe,b as i,V as be}from"./vee-validate.esm-9ddfb914.js";import{V as ye}from"./VContainer-78883166.js";import{V as ke,a as A}from"./VRow-96134f9b.js";import{V as Ce}from"./VTextarea-02fd7b99.js";import{V as we}from"./VCheckbox-7b565291.js";/* empty css              */const xe=ce("h1",{class:"text-center"},"✦ 活動管理 ✦",-1),Ie={__name:"ProductsView",setup(he){const B=Q(),S=r(5),c=r([{key:"name",order:"asc"}]),p=r(1),U=r([]),L=[{title:"活動名稱",align:"center",sortable:!0,key:"name"},{title:"活動封面",align:"center",sortable:!1,key:"image"},{title:"活動日期",align:"center",sortable:!0,key:"date"},{title:"報名費用",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],P=r(!1),D=r(0),v=r(""),I=()=>{p.value=1,n()},n=async()=>{P.value=!0;try{const{data:t}=await M.get("/products/all",{params:{page:p.value,itemsPerPage:S.value,sortBy:c.value[0].key,sortOrder:c.value[0].order,search:v.value}});U.value.splice(0,U.value.length,...t.result.data),D.value=t.result.count}catch(t){B({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"#B71C1C",location:"bottom"}})}P.value=!1};n();const N=t=>{u.value=t._id,g.value.value=t.name,V.value.value=t.price,f.value.value=t.date,b.value.value=t.description,y.value.value=t.category,k.value.value=t.sell,d.value=!0},d=r(!1),u=r(""),z=()=>{u.value="",d.value=!0},T=()=>{d.value=!1,H(),q.value.deleteFileRecord()},_=["工作坊","展覽講座","投稿活動"],K=ve({name:h().required("缺少名稱"),date:h().required("缺少日期"),price:ge().typeError("缺少費用").required("缺少費用").min(0,"價格錯誤"),description:h().required("缺少說明"),category:h().required("缺少分類").test("isCategory",t=>_.includes(t)),sell:Ve()}),{handleSubmit:R,isSubmitting:F,resetForm:H}=fe({validationSchema:K,initialValues:{name:"",price:0,date:"",description:"",category:"",sell:!1}}),g=i("name"),V=i("price"),f=i("date"),b=i("description"),y=i("category"),k=i("sell"),m=r([]),$=r([]),q=r(null),O=R(async t=>{if(!(u.value.length===0&&m.value.length===0))try{const e=new FormData;e.append("name",t.name),e.append("price",t.price),e.append("date",t.date),e.append("description",t.description),e.append("category",t.category),e.append("sell",t.sell),m.value.length>0&&e.append("image",m.value[0].file),u.value.length>0?await M.patch("/products/"+u.value,e):await M.post("/products",e),B({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"#1A237E",location:"bottom"}}),T(),n()}catch(e){console.log(e),B({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"#B71C1C",location:"bottom"}})}});return(t,e)=>{const G=j("VDataTableServer"),J=j("VueFileAgent");return E(),W(Y,null,[l(ye,null,{default:s(()=>[l(ke,null,{default:s(()=>[l(A,{cols:"12"},{default:s(()=>[xe]),_:1}),l(Z),l(A,{cols:"12"},{default:s(()=>[l(G,{"items-per-page":S.value,"onUpdate:itemsPerPage":[e[1]||(e[1]=a=>S.value=a),n],"sort-by":c.value,"onUpdate:sortBy":[e[2]||(e[2]=a=>c.value=a),n],page:p.value,"onUpdate:page":[e[3]||(e[3]=a=>p.value=a),n],items:U.value,headers:L,loading:P.value,"items-length":D.value,search:v.value,hover:"",class:"my-4"},{top:s(()=>[l(C,{label:"搜尋","append-icon":"mdi-magnify","max-width":"20","onClick:append":I,onKeydown:ee(I,["enter"]),modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a)},null,8,["onKeydown","modelValue"])]),"item.image":s(({item:a})=>[l(ae,{src:a.raw.image,height:"60px"},null,8,["src"])]),"item.sell":s(({item:a})=>[a.raw.sell?(E(),le(pe,{key:0,icon:"mdi-check"})):te("",!0)]),"item.edit":s(({item:a})=>[l(w,{icon:"mdi-pencil",onClick:Be=>N(a.raw),variant:"text"},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1}),l(A,{class:"d-flex justify-center align-end"},{default:s(()=>[l(w,{"prepend-icon":"mdi-plus",color:"#0e2a47ff",theme:"dark",onClick:z,class:"my-4",width:"180"},{default:s(()=>[x("新增活動 ")]),_:1})]),_:1})]),_:1})]),_:1}),l(X,{persistent:"",width:"500px",modelValue:d.value,"onUpdate:modelValue":e[12]||(e[12]=a=>d.value=a)},{default:s(()=>[l(be,{disabled:o(F),onSubmit:oe(o(O),["prevent"])},{default:s(()=>[l(se,{class:"px-2"},{default:s(()=>[l(re,{class:"my-4 text-h5 text-center",color:"#fcf8f2"},{default:s(()=>[x(ne(u.value.length>0?"✦ 編輯活動 ✦":"✦ 新增活動 ✦"),1)]),_:1}),l(ue,null,{default:s(()=>[l(C,{label:"活動名稱",variant:"outlined",modelValue:o(g).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>o(g).value.value=a),"error-messages":o(g).errorMessage.value},null,8,["modelValue","error-messages"]),l(J,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a),"raw-model-value":$.value,"onUpdate:rawModelValue":e[6]||(e[6]=a=>$.value=a),"max-files":1,"max-size":"1MB",accept:"image/jpg,image/jpeg,image/png",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖放到這裡",deletable:"",ref_key:"fileAgent",ref:q},null,8,["modelValue","raw-model-value"]),l(C,{label:"日期",class:"mt-4",variant:"outlined",modelValue:o(f).value.value,"onUpdate:modelValue":e[7]||(e[7]=a=>o(f).value.value=a),"error-messages":o(f).errorMessage.value},null,8,["modelValue","error-messages"]),l(C,{label:"參加費用",class:"mt-4",variant:"outlined",modelValue:o(V).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>o(V).value.value=a),modelModifiers:{number:!0},"error-messages":o(V).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),l(Ce,{label:"活動說明",variant:"outlined",modelValue:o(b).value.value,"onUpdate:modelValue":e[9]||(e[9]=a=>o(b).value.value=a),"error-messages":o(b).errorMessage.value},null,8,["modelValue","error-messages"]),l(ie,{label:"分類",variant:"outlined",modelValue:o(y).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>o(y).value.value=a),"error-messages":o(y).errorMessage.value,items:_},null,8,["modelValue","error-messages"]),l(we,{label:"上架",modelValue:o(k).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>o(k).value.value=a),"error-messages":o(k).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(de,null,{default:s(()=>[l(me),l(w,{color:"#B71C1C",onClick:T,loading:o(F),"prepend-icon":"mdi-close"},{default:s(()=>[x("取消")]),_:1},8,["loading"]),l(w,{color:"#0e2a47ff",type:"submit",loading:o(F),"prepend-icon":"mdi-check"},{default:s(()=>[x("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{Ie as default};
