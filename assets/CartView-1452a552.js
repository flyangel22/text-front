import{a4 as B,a5 as q,b1 as N,r as b,c as v,ao as m,a8 as d,ab as P,aa as l,j as a,b2 as S,am as e,a9 as h,ah as T,a2 as $,ac as D,a_ as I,an as n,V as _,ae as V,ay as R,b3 as U,au as j}from"./index-69c4fa7b.js";import{V as z}from"./VContainer-e5631dac.js";import{V as A,a as i}from"./VRow-f27d63c0.js";import{V as E}from"./VTextarea-234381aa.js";/* empty css              */const F=e("h1",{class:"text-center"},"✦ 購物車 ✦",-1),L=e("thead",{class:"bg-color"},[e("tr",null,[e("th",{class:"text-white"},"活動封面"),e("th",{class:"text-white"},"活動名稱"),e("th",{class:"text-white"},"活動日期"),e("th",{class:"text-white text-center"},"人數"),e("th",{class:"text-white"},"費用"),e("th",{class:"text-white"},"小計")])],-1),G={class:"text-center"},H={key:0},J=e("td",{colspan:"6",class:"text-center"},"沒有商品",-1),K=[J],Z={__name:"CartView",setup(M){const u=B(),x=q(),C=N(),o=b([]),p=b(""),f=async(s,r)=>{try{const{data:t}=await m.post("/users/cart",{product:s,quantity:r}),c=o.value.findIndex(g=>g.product._id===s);if(o.value[c].quantity+r>5){u({text:"超過人數上限",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"#B71C1C",location:"bottom"}});return}o.value[c].quantity+=r,o.value[c].quantity<=0&&o.value.splice(c,1),x.cart=t.result}catch(t){u({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},k=v(()=>o.value.reduce((s,r)=>s+r.quantity*r.product.price,0)),w=v(()=>o.value.length>0&&!o.value.some(s=>!s.product.sell)),y=async(s,r)=>{try{await m.post("/orders",{note:p.value}),x.cart=0,C.push("/orders")}catch(t){console.log(t),u({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(async()=>{try{const{data:s}=await m.get("/users/cart");o.value.push(...s.result)}catch(s){u({text:s.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),(s,r)=>(d(),P(z,{class:"custom-container"},{default:l(()=>[a(R,{class:"mx-auto pa-12 pb-8"},{default:l(()=>[a(A,null,{default:l(()=>[a(i,{cols:"12"},{default:l(()=>[F]),_:1}),a(i,{cols:"12"},{default:l(()=>[a(S,null,{default:l(()=>[L,e("tbody",null,[(d(!0),h($,null,T(o.value,t=>(d(),h("tr",{key:t._id,class:U({"bg-red-lighten-5":!t.product.sell})},[e("td",null,[a(j,{src:t.product.image,cover:"",width:"150","aspect-ratio":"1"},null,8,["src"])]),e("td",null,n(t.product.name),1),e("td",null,n(t.product.date),1),e("td",G,[a(_,{color:"primary",variant:"text",icon:"mdi-minus",onClick:c=>f(t.product._id,-1)},null,8,["onClick"]),V(" "+n(t.quantity)+" ",1),a(_,{color:"primary",variant:"text",icon:"mdi-plus",onClick:c=>f(t.product._id,1)},null,8,["onClick"])]),e("td",null,n(t.product.price),1),e("td",null,n(t.quantity*t.product.price),1)],2))),128)),o.value.length===0?(d(),h("tr",H,K)):D("",!0)])]),_:1})]),_:1}),a(I),a(i,{cols:"12",class:"text-center mt-4 ml-4"},{default:l(()=>[a(E,{modelValue:p.value,"onUpdate:modelValue":r[0]||(r[0]=t=>p.value=t),label:"備註",rows:"4","prepend-icon":"mdi-message-reply-text-outline",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(i,{cols:"12",class:"text-center"},{default:l(()=>[e("h2",null,"總計費用: $"+n(k.value),1),a(_,{color:"#0e2a47ff",theme:"dark",onClick:y,disabled:!w.value,class:"mt-4"},{default:l(()=>[V("報名")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Z as default};
